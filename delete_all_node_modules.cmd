@echo off

REM Usage: %~nx0 "C:\path\to\root"

IF "%~1"=="" (
    echo Usage: %~nx0 "C:\path\to\root"
    exit /b 1
)

SET "ROOT_DIR=%~1"
SET "ERRORS=0"

echo Deleting all node_modules directories recursively from "%ROOT_DIR%"...

for /d /r "%ROOT_DIR%" %%d in (node_modules) do (
    if exist "%%d" (
        echo Removing "%%d"
        rd /s /q "%%d"
        if errorlevel 1 (
            echo WARNING: Failed to remove "%%d" - it may be locked by a running process
            SET "ERRORS=1"
        )
    )
)

if "%ERRORS%"=="1" (
    echo Completed with errors.
    exit /b 1
) else (
    echo Completed.
    exit /b 0
)
